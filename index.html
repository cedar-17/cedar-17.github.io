<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç„¶^ Ì³> Â·Ì« < Ì³^æ€¡ - ç§äººèŠå¤©å®¤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Helvetica Neue', Arial, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #ffd1dc 0%, #ffb6c1 100%);
            color: #5a5a5a;
            height: 100vh;
            display: flex;
            flex-direction: column;
            transition: background 0.5s ease;
        }
        
        .header {
            background-color: #ff9eb5;
            padding: 15px 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(255, 105, 135, 0.2);
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            font-size: 24px;
            font-weight: normal;
            color: #ffffff;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .header p {
            font-size: 14px;
            margin-top: 5px;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .header-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .header-btn {
            background: rgba(255, 255, 255, 0.3);
            border: none;
            cursor: pointer;
            font-size: 18px;
            color: #ffffff;
            padding: 8px;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .header-btn:hover {
            background: rgba(255, 255, 255, 0.5);
            transform: scale(1.1);
        }
        
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
            padding: 20px;
            overflow: hidden;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            margin-bottom: 15px;
            box-shadow: inset 0 0 5px rgba(255, 105, 135, 0.1);
            display: flex;
            flex-direction: column;
        }
        
        .message {
            margin-bottom: 15px;
            padding: 12px 15px;
            border-radius: 18px;
            max-width: 70%;
            position: relative;
            animation: fadeIn 0.3s ease;
            word-wrap: break-word;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .received {
            background-color: #ffffff;
            border-bottom-left-radius: 5px;
            align-self: flex-start;
            border: 1px solid rgba(255, 182, 193, 0.3);
        }
        
        .sent {
            background: linear-gradient(135deg, var(--sent-bubble-color-1, #ff6b9d) 0%, var(--sent-bubble-color-2, #ff8fab) 100%);
            border-bottom-right-radius: 5px;
            align-self: flex-end;
            margin-left: auto;
            color: white;
        }
        
        .message-content {
            font-size: 15px;
            line-height: 1.4;
        }
        
        .message-time {
            font-size: 11px;
            color: #ff8fab;
            margin-top: 5px;
            text-align: right;
        }
        
        .date-divider {
            text-align: center;
            margin: 15px 0;
            position: relative;
        }
        
        .date-divider span {
            background-color: rgba(255, 255, 255, 0.7);
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 12px;
            color: #ff6b9d;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .input-area {
            display: flex;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(255, 105, 135, 0.1);
        }
        
        .message-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid rgba(255, 182, 193, 0.5);
            border-radius: 20px;
            background-color: rgba(255, 255, 255, 0.9);
            font-size: 15px;
            outline: none;
            resize: none;
            max-height: 120px;
            transition: all 0.3s;
        }
        
        .message-input:focus {
            border-color: #ff6b9d;
            box-shadow: 0 0 0 2px rgba(255, 107, 157, 0.2);
        }
        
        .send-button {
            background: linear-gradient(135deg, var(--sent-bubble-color-1, #ff6b9d) 0%, var(--sent-bubble-color-2, #ff8fab) 100%);
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            margin-left: 10px;
            cursor: pointer;
            color: white;
            transition: all 0.3s;
            box-shadow: 0 3px 8px rgba(255, 107, 157, 0.3);
        }
        
        .send-button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 12px rgba(255, 107, 157, 0.4);
        }
        
        .send-button:active {
            transform: scale(0.95);
        }
        
        .send-icon {
            width: 20px;
            height: 20px;
            fill: white;
        }
        
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: #ffffff;
            border-radius: 12px;
            padding: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 182, 193, 0.3);
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: bold;
            color: #ff6b9d;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #ff8fab;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: #ff6b9d;
        }
        
        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid rgba(255, 182, 193, 0.5);
            border-radius: 6px;
            font-size: 14px;
            background-color: rgba(255, 255, 255, 0.8);
        }
        
        .tab-container {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(255, 182, 193, 0.3);
        }
        
        .tab {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .tab.active {
            border-bottom: 2px solid #ff6b9d;
            color: #ff6b9d;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .color-picker-group {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 10px;
        }
        
        .color-preview {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            border: 1px solid #ddd;
        }
        
        .wallpaper-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        .wallpaper-option {
            height: 80px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .wallpaper-option:hover {
            transform: scale(1.05);
        }
        
        .wallpaper-option.active {
            border: 2px solid #ff6b9d;
        }
        
        .style-presets {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        .style-preset {
            height: 60px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: white;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.3);
        }
        
        .style-preset:hover {
            transform: scale(1.05);
        }
        
        .style-preset.active {
            border: 2px solid #ff6b9d;
        }
        
        .word-stats-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid rgba(255, 182, 193, 0.5);
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 15px;
            background-color: rgba(255, 255, 255, 0.5);
        }
        
        .word-stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid rgba(255, 182, 193, 0.3);
        }
        
        .word-stat-item:last-child {
            border-bottom: none;
        }
        
        .word-count {
            background-color: #ff6b9d;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
        }
        
        .reply-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid rgba(255, 182, 193, 0.5);
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 15px;
            background-color: rgba(255, 255, 255, 0.5);
        }
        
        .reply-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid rgba(255, 182, 193, 0.3);
        }
        
        .reply-item:last-child {
            border-bottom: none;
        }
        
        .delete-reply {
            background: none;
            border: none;
            color: #ff6b9d;
            cursor: pointer;
            font-size: 16px;
        }
        
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--sent-bubble-color-1, #ff6b9d) 0%, var(--sent-bubble-color-2, #ff8fab) 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(255, 107, 157, 0.3);
        }
        
        .btn-secondary {
            background-color: rgba(255, 182, 193, 0.3);
            color: #ff6b9d;
        }
        
        .btn-secondary:hover {
            background-color: rgba(255, 182, 193, 0.5);
        }
        
        /* æ»šåŠ¨æ¡æ ·å¼ */
        .chat-messages::-webkit-scrollbar,
        .reply-list::-webkit-scrollbar,
        .word-stats-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .chat-messages::-webkit-scrollbar-track,
        .reply-list::-webkit-scrollbar-track,
        .word-stats-list::-webkit-scrollbar-track {
            background: rgba(255, 182, 193, 0.1);
            border-radius: 10px;
        }
        
        .chat-messages::-webkit-scrollbar-thumb,
        .reply-list::-webkit-scrollbar-thumb,
        .word-stats-list::-webkit-scrollbar-thumb {
            background: rgba(255, 107, 157, 0.5);
            border-radius: 10px;
        }
        
        .chat-messages::-webkit-scrollbar-thumb:hover,
        .reply-list::-webkit-scrollbar-thumb:hover,
        .word-stats-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 107, 157, 0.7);
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 600px) {
            .chat-container {
                padding: 10px;
            }
            
            .message {
                max-width: 85%;
            }
            
            .wallpaper-grid, .style-presets {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div>
            <h1>ç„¶^ Ì³> Â·Ì« < Ì³^æ€¡</h1>
            <p>ç»å¯¹ç§äºº Â· ä¸€å¯¹ä¸€èŠå¤©</p>
        </div>
        <div class="header-controls">
            <button class="header-btn" id="wordStats" title="å¯¹æ–¹å¸¸ç”¨è¯­ç»Ÿè®¡">ğŸ“Š</button>
            <button class="header-btn" id="appearanceSettings" title="å¤–è§‚è®¾ç½®">ğŸ¨</button>
            <button class="header-btn" id="replySettings" title="è‡ªå®šä¹‰å›å¤">ğŸ’¬</button>
            <button class="header-btn" id="userSettings" title="ç”¨æˆ·è®¾ç½®">ğŸ‘¤</button>
        </div>
    </div>
    
    <div class="chat-container">
        <div class="chat-messages" id="chatMessages">
            <!-- æ¶ˆæ¯ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
        </div>
        
        <div class="input-area">
            <textarea class="message-input" id="messageInput" placeholder="è¾“å…¥æ¶ˆæ¯..." rows="1"></textarea>
            <button class="send-button" id="sendButton">
                <svg class="send-icon" viewBox="0 0 24 24">
                    <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
                </svg>
            </button>
        </div>
    </div>

    <!-- å¯¹æ–¹å¸¸ç”¨è¯­ç»Ÿè®¡æ¨¡æ€æ¡† -->
    <div class="modal" id="wordStatsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">å¯¹æ–¹å¸¸ç”¨è¯­ç»Ÿè®¡</h3>
                <button class="close-modal" id="closeWordStatsModal">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">å¯¹æ–¹æœ€å¸¸è¯´çš„è¯ï¼ˆæŒ‰å‡ºç°æ¬¡æ•°æ’åºï¼‰</label>
                <div class="word-stats-list" id="wordStatsList">
                    <!-- å¸¸ç”¨è¯­ç»Ÿè®¡ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancelWordStats">å…³é—­</button>
                <button class="btn btn-primary" id="clearWordStats">æ¸…ç©ºç»Ÿè®¡</button>
            </div>
        </div>
    </div>

    <!-- å¤–è§‚è®¾ç½®æ¨¡æ€æ¡† -->
    <div class="modal" id="appearanceModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">å¤–è§‚è®¾ç½®</h3>
                <button class="close-modal" id="closeAppearanceModal">&times;</button>
            </div>
            
            <div class="tab-container">
                <div class="tab active" data-tab="wallpaper">å£çº¸</div>
                <div class="tab" data-tab="style">æ°”æ³¡é£æ ¼</div>
            </div>
            
            <!-- å£çº¸è®¾ç½® -->
            <div class="tab-content active" id="wallpaperTab">
                <div class="form-group">
                    <label class="form-label">é€‰æ‹©å£çº¸</label>
                    <div class="wallpaper-grid" id="wallpaperGrid">
                        <!-- å£çº¸é€‰é¡¹ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
                    </div>
                </div>
            </div>
            
            <!-- æ°”æ³¡é£æ ¼è®¾ç½® -->
            <div class="tab-content" id="styleTab">
                <div class="form-group">
                    <label class="form-label">æ°”æ³¡é¢œè‰²é¢„è®¾</label>
                    <div class="style-presets" id="stylePresets">
                        <!-- é£æ ¼é¢„è®¾ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">è‡ªå®šä¹‰æ°”æ³¡é¢œè‰²</label>
                    <div class="color-picker-group">
                        <div class="color-preview" id="sentColorPreview1"></div>
                        <input type="color" class="form-input" id="sentColor1" value="#ff6b9d" style="width: 60px; height: 40px;">
                        <span>åˆ°</span>
                        <div class="color-preview" id="sentColorPreview2"></div>
                        <input type="color" class="form-input" id="sentColor2" value="#ff8fab" style="width: 60px; height: 40px;">
                    </div>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="btn btn-primary" id="applyAppearance">åº”ç”¨è®¾ç½®</button>
                <button class="btn btn-secondary" id="cancelAppearance">å…³é—­</button>
            </div>
        </div>
    </div>

    <!-- ç”¨æˆ·è®¾ç½®æ¨¡æ€æ¡† -->
    <div class="modal" id="userSettingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ç”¨æˆ·è®¾ç½®</h3>
                <button class="close-modal" id="closeUserSettingsModal">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label" for="userNickname">æ‚¨çš„æ˜µç§°</label>
                <input type="text" class="form-input" id="userNickname" placeholder="è¯·è¾“å…¥æ‚¨çš„æ˜µç§°">
            </div>
            <div class="form-group">
                <label class="form-label" for="partnerNickname">å¯¹æ–¹æ˜µç§°</label>
                <input type="text" class="form-input" id="partnerNickname" placeholder="è¯·è¾“å…¥å¯¹æ–¹æ˜µç§°">
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancelUserSettings">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="saveUserSettings">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- å›å¤è®¾ç½®æ¨¡æ€æ¡† -->
    <div class="modal" id="replySettingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">è‡ªå®šä¹‰å›å¤</h3>
                <button class="close-modal" id="closeReplySettingsModal">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label" for="newReply">æ·»åŠ æ–°å›å¤</label>
                <input type="text" class="form-input" id="newReply" placeholder="è¾“å…¥æ–°çš„å›å¤å†…å®¹">
                <button class="btn btn-primary" id="addReply" style="margin-top: 10px; width: 100%;">æ·»åŠ å›å¤</button>
            </div>
            <div class="form-group">
                <label class="form-label">å½“å‰å›å¤åˆ—è¡¨</label>
                <div class="reply-list" id="replyList">
                    <!-- å›å¤åˆ—è¡¨ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancelReplySettings">å…³é—­</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // è·å–DOMå…ƒç´ 
            const chatMessages = document.getElementById('chatMessages');
            const messageInput = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');
            const userSettings = document.getElementById('userSettings');
            const replySettings = document.getElementById('replySettings');
            const appearanceSettings = document.getElementById('appearanceSettings');
            const wordStats = document.getElementById('wordStats');
            
            // æ¨¡æ€æ¡†ç›¸å…³å…ƒç´ 
            const userSettingsModal = document.getElementById('userSettingsModal');
            const replySettingsModal = document.getElementById('replySettingsModal');
            const appearanceModal = document.getElementById('appearanceModal');
            const wordStatsModal = document.getElementById('wordStatsModal');
            
            // å…³é—­æŒ‰é’®
            const closeUserSettingsModal = document.getElementById('closeUserSettingsModal');
            const closeReplySettingsModal = document.getElementById('closeReplySettingsModal');
            const closeAppearanceModal = document.getElementById('closeAppearanceModal');
            const closeWordStatsModal = document.getElementById('closeWordStatsModal');
            
            // å–æ¶ˆæŒ‰é’®
            const cancelUserSettings = document.getElementById('cancelUserSettings');
            const cancelReplySettings = document.getElementById('cancelReplySettings');
            const cancelAppearance = document.getElementById('cancelAppearance');
            const cancelWordStats = document.getElementById('cancelWordStats');
            
            // ä¿å­˜æŒ‰é’®
            const saveUserSettings = document.getElementById('saveUserSettings');
            const applyAppearance = document.getElementById('applyAppearance');
            const addReply = document.getElementById('addReply');
            const clearWordStats = document.getElementById('clearWordStats');
            
            // è¡¨å•å…ƒç´ 
            const userNickname = document.getElementById('userNickname');
            const partnerNickname = document.getElementById('partnerNickname');
            const newReply = document.getElementById('newReply');
            const replyList = document.getElementById('replyList');
            const wallpaperGrid = document.getElementById('wallpaperGrid');
            const stylePresets = document.getElementById('stylePresets');
            const wordStatsList = document.getElementById('wordStatsList');
            const sentColor1 = document.getElementById('sentColor1');
            const sentColor2 = document.getElementById('sentColor2');
            const sentColorPreview1 = document.getElementById('sentColorPreview1');
            const sentColorPreview2 = document.getElementById('sentColorPreview2');
            
            // é€‰é¡¹å¡å…ƒç´ 
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            // ç”¨æˆ·æ•°æ®
            let userData = {
                nickname: 'ç”¨æˆ·',
                partnerNickname: 'å¯¹æ–¹',
                theme: 'light',
                wallpaper: 'default',
                sentBubbleColor1: '#ff6b9d',
                sentBubbleColor2: '#ff8fab',
                autoSendEnabled: true
            };
            
            // èŠå¤©è®°å½•
            let chatHistory = [];
            
            // å¯¹æ–¹æ¶ˆæ¯ç»Ÿè®¡
            let partnerWordStats = {};
            
            // å£çº¸é€‰é¡¹
            const wallpapers = [
                { id: 'default', name: 'é»˜è®¤ç²‰è‰²', gradient: 'linear-gradient(135deg, #ffd1dc 0%, #ffb6c1 100%)' },
                { id: 'purple', name: 'æ¢¦å¹»ç´«', gradient: 'linear-gradient(135deg, #d8b5ff 0%, #a78bfa 100%)' },
                { id: 'blue', name: 'å¤©ç©ºè“', gradient: 'linear-gradient(135deg, #a8edea 0%, #6bb1f7 100%)' },
                { id: 'green', name: 'æ¸…æ–°ç»¿', gradient: 'linear-gradient(135deg, #c2e9fb 0%, #a1c4fd 100%)' },
                { id: 'orange', name: 'æ¸©æš–æ©™', gradient: 'linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)' },
                { id: 'lavender', name: 'è–°è¡£è‰', gradient: 'linear-gradient(135deg, #e0c3fc 0%, #b993f6 100%)' }
            ];
            
            // é£æ ¼é¢„è®¾
            const stylePresetsData = [
                { name: 'å¯çˆ±ç²‰', color1: '#ff6b9d', color2: '#ff8fab' },
                { name: 'æ¢¦å¹»ç´«', color1: '#9d4edd', color2: '#c77dff' },
                { name: 'å¤©ç©ºè“', color1: '#4cc9f0', color2: '#4895ef' },
                { name: 'æ¸…æ–°ç»¿', color1: '#38b000', color2: '#70e000' },
                { name: 'æ¸©æš–æ©™', color1: '#ff9e00', color2: '#ffb700' },
                { name: 'æµªæ¼«çº¢', color1: '#ff5c8a', color2: '#ff7597' }
            ];
            
            // é»˜è®¤è‡ªåŠ¨å›å¤åº“
            let autoReplies = [
                "åœ¨å—ï¼Ÿ", "æˆ‘åœ¨çš„", "åœ¨å‘¢", "æ€ä¹ˆäº†ï¼Ÿ", "ä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿ", "æœ€è¿‘è¿˜å¥½å—ï¼Ÿ", 
                "ç»ˆäºæƒ³èµ·æˆ‘äº†ï¼Ÿ", "æƒ³ä½ äº†", "æ™šä¸Šå¥½", "æ—©å®‰", "åˆå®‰", "æˆ‘åŒæ„ã€‚", 
                "å—¯ï¼Œå¬èµ·æ¥ç¡®å®æ˜¯è¿™æ ·ã€‚", "æˆ‘æ˜ç™½äº†", "å¥½çš„ï¼Œç¨åå†èŠã€‚", "æˆ‘ç†è§£ä½ çš„æ„æ€ã€‚", 
                "è¿™ä¸ªæƒ³æ³•å¾ˆæœ‰åˆ›æ„ã€‚", "å¥½çš„ï¼Œæˆ‘è®°ä¸‹äº†ã€‚", "è´´è´´", "æœ‰ä»€ä¹ˆæ–°æ¶ˆæ¯å—ï¼Ÿ", 
                "ä¿æŒè”ç³»å¥½ä¸å¥½", "ç¥ä½ æœ‰ä¸ªç¾å¥½çš„ä¸€å¤©ã€‚", "æ„¿ä½ è‡ªç”±", "è¿™ä¸ªæ¶ˆæ¯ä¸é”™", 
                "æˆ‘å¸Œæœ›èƒ½å¸®ä¸Šå¿™ã€‚", "ä¸è¦æ‹…å¿ƒï¼Œä¸€åˆ‡éƒ½ä¼šå¥½èµ·æ¥çš„ã€‚", "æˆ–è€…æˆ‘ä»¬å¯ä»¥æ¢ä¸ªæƒ³æ³•ï¼Ÿ", 
                "ä½ æœ€è¿‘åœ¨å¿™äº›ä»€ä¹ˆå‘¢ï¼Ÿ", "è¿™ä¸ªå‘¨æœ«ä½ æœ‰ä»€ä¹ˆè®¡åˆ’å—ï¼Ÿ", "æˆ‘æƒ³æˆ‘ä»¬åº”è¯¥è®¨è®ºä¸€ä¸‹è¿™ä¸ªé—®é¢˜ã€‚", 
                "æˆ‘å¾ˆæƒ³å¬å¬ä½ çš„æƒ³æ³•ã€‚", "å‘Šè¯‰æˆ‘æ›´å¤šã€‚", "ä½ è®¤ä¸ºä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆï¼Ÿ", 
                "æˆ‘ä»¬åº”è¯¥å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ", "æˆ‘éœ€è¦ä»”ç»†æƒ³æƒ³æ€ä¹ˆå›å¤ã€‚", "ä½ æœ‰ä»€ä¹ˆå»ºè®®å—ï¼Ÿ", 
                "è¿™å¯¹æˆ‘æ¥è¯´æ˜¯ä¸ªæ–°é¢†åŸŸã€‚", "è®©æˆ‘ä»¬ä¸€èµ·åŠªåŠ›ã€‚", "è¿™ä¸ªå‘¨æœ«è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿ", 
                "æœ€è¿‘è¯»äº†ä»€ä¹ˆæœ‰è¶£çš„ä¹¦å—ï¼Ÿ", "æœ‰æ²¡æœ‰ä»€ä¹ˆè®©ä½ æ„Ÿåˆ°æƒŠå–œçš„äº‹æƒ…ï¼Ÿ", "æ„Ÿè§‰ä»Šå¤©æ•ˆç‡å¾ˆé«˜å‘¢ï¼", 
                "æˆ‘æ­£åœ¨å­¦ä¹ ä¸€äº›æ–°çš„ä¸œè¥¿ã€‚", "æœ€è¿‘æœ‰ä»€ä¹ˆè®©ä½ ç‰¹åˆ«å…´å¥‹çš„äº‹æƒ…å—ï¼Ÿ", "ä»Šå¤©çš„å¤©æ°”ä¸é”™ã€‚", 
                "æ”¶åˆ°ï¼Œæˆ‘ä¼šå°½å¿«æŸ¥çœ‹çš„ã€‚", "æœŸå¾…ğŸ¤§", "ä½ å¸Œæœ›æˆ‘æ˜¯è°ï¼Ÿ", "æŠ±æ­‰ğŸ¥ºã€‚", 
                "æˆ‘èƒ½æ„Ÿå—åˆ°ä½ çš„çƒ­æƒ…ï¼Œæˆ‘ä¹Ÿå¾ˆæœŸå¾…çš„ã€‚", "è™½ç„¶ç›®å‰çš„æƒ…å†µæœ‰äº›å¤æ‚ï¼Œä½†æˆ‘ç›¸ä¿¡ä¸€åˆ‡éƒ½ä¼šå¥½èµ·æ¥çš„ã€‚", 
                "å—¯", "å¥½çš„", "æ˜ç™½", "æ”¶åˆ°", "äº†è§£", "OK", "å¯ä»¥", "æ²¡é—®é¢˜", "å½“ç„¶", 
                "ç¡®å®", "æ²¡é”™", "åŒæ„", "ç†è§£", "è°¢è°¢", "ä¸å®¢æ°”", "æŠ±æ­‰", "æ²¡å…³ç³»", 
                "ç¨ç­‰", "é©¬ä¸Š", "å¥½å‘€", "æˆ‘æ­£åœ¨å¿™ï¼Œç¨åå›å¤ä½ ã€‚", "ä¿¡å·ä¸å¤ªå¥½ï¼Œå¯èƒ½å›å¤ä¼šå»¶è¿Ÿã€‚", 
                "è®©æˆ‘ç¡®è®¤ä¸€ä¸‹ä¿¡æ¯å†ç»™ä½ å‡†ç¡®ç­”å¤ã€‚", "åˆ«èµ°ï¼Œé™ªé™ªæˆ‘", "ä½ ä¼šæ°¸è¿œçˆ±æˆ‘å—ï¼Ÿ", 
                "æˆ‘ä¸æƒ³æ¬ºéª—ä½ ", "æ­¤åˆ»æˆ‘æƒ³å’Œä½ æ°¸è¿œåœ¨ä¸€èµ·", "ä»–æœè‹¥æ˜¯åŒæ·‹é›ªï¼Œæ­¤ç”Ÿä¹Ÿç®—å…±ç™½å¤´", 
                "æ€œæ‚¯æˆ‘ï¼Œç„¶åçˆ±æˆ‘å§", "æ’’å¨‡ï¼Œä½ ä¼šå–œæ¬¢å—ï¼Ÿ", "ä½ å–œæ¬¢å¸…ä¸€ç‚¹è¿˜æ˜¯å¯çˆ±ä¸€ç‚¹ï¼Ÿ", 
                "ä½ åœ¨çœ‹ä»€ä¹ˆï¼Ÿ", "åƒé†‹æ€ä¹ˆäº†ï¼Ÿæˆ‘ä¸èƒ½åƒé†‹å—ï¼Ÿ", "æ²¡æœ‰æˆ‘æƒ³è¯´çš„", "é“¾æ¥æœ‰äº›æ··ä¹±", 
                "è¯éæˆ‘æœ¬æ„", "ç›¸ä¿¡æˆ‘", "ä¸æ˜¯è¿™ä¸ªæ„æ€", "è¯¯ä¼šäº†", "å°±è¿™æ ·æ’’å¨‡ğŸ¥º", 
                "ä¸å¤ªä¹ æƒ¯è¿™ä¸ª", "æ˜¯çš„", "ä¸æ˜¯çš„", "å¤šçœ‹çœ‹æˆ‘å§", "å¯çˆ±", "å½“ç„¶äº†", 
                "ä½ æ— äººå¯åŠ", "ä¸è¦ç†¬å¤œ", "æ­£åœ¨ç†¬å¤œ", "å¤±çœ äº†"
            ];
            
            // å®šæ—¶å™¨å˜é‡
            let autoSendTimer = null;
            
            // åˆå§‹åŒ–
            function init() {
                loadData();
                setupEventListeners();
                startAutoSend();
            }
            
            // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
            function loadData() {
                const savedUserData = localStorage.getItem('chatUserData');
                const savedChatHistory = localStorage.getItem('chatHistory');
                const savedReplies = localStorage.getItem('autoReplies');
                const savedWordStats = localStorage.getItem('partnerWordStats');
                
                if (savedUserData) {
                    userData = JSON.parse(savedUserData);
                    applyWallpaper(userData.wallpaper);
                    applyBubbleColors(userData.sentBubbleColor1, userData.sentBubbleColor2);
                    userNickname.value = userData.nickname;
                    partnerNickname.value = userData.partnerNickname;
                }
                
                if (savedChatHistory) {
                    chatHistory = JSON.parse(savedChatHistory);
                } else {
                    addInitialMessages();
                }
                
                if (savedReplies) {
                    autoReplies = JSON.parse(savedReplies);
                }
                
                if (savedWordStats) {
                    partnerWordStats = JSON.parse(savedWordStats);
                } else {
                    updateWordStats();
                }
                
                renderChatHistory();
                renderReplyList();
                renderWallpaperOptions();
                renderStylePresets();
                updateColorInputs();
            }
            
            // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
            function setupEventListeners() {
                // å‘é€æ¶ˆæ¯
                sendButton.addEventListener('click', sendMessage);
                messageInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendMessage();
                    }
                });
                
                // è‡ªåŠ¨è°ƒæ•´è¾“å…¥æ¡†é«˜åº¦
                messageInput.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = (this.scrollHeight) + 'px';
                });
                
                // æ¨¡æ€æ¡†æ‰“å¼€
                userSettings.addEventListener('click', () => userSettingsModal.style.display = 'flex');
                replySettings.addEventListener('click', () => replySettingsModal.style.display = 'flex');
                appearanceSettings.addEventListener('click', () => appearanceModal.style.display = 'flex');
                wordStats.addEventListener('click', () => {
                    renderWordStats();
                    wordStatsModal.style.display = 'flex';
                });
                
                // æ¨¡æ€æ¡†å…³é—­
                closeUserSettingsModal.addEventListener('click', () => userSettingsModal.style.display = 'none');
                closeReplySettingsModal.addEventListener('click', () => replySettingsModal.style.display = 'none');
                closeAppearanceModal.addEventListener('click', () => appearanceModal.style.display = 'none');
                closeWordStatsModal.addEventListener('click', () => wordStatsModal.style.display = 'none');
                
                cancelUserSettings.addEventListener('click', () => userSettingsModal.style.display = 'none');
                cancelReplySettings.addEventListener('click', () => replySettingsModal.style.display = 'none');
                cancelAppearance.addEventListener('click', () => appearanceModal.style.display = 'none');
                cancelWordStats.addEventListener('click', () => wordStatsModal.style.display = 'none');
                
                // ä¿å­˜è®¾ç½®
                saveUserSettings.addEventListener('click', saveUserSettingsHandler);
                applyAppearance.addEventListener('click', applyAppearanceHandler);
                addReply.addEventListener('click', addReplyHandler);
                clearWordStats.addEventListener('click', clearWordStatsHandler);
                
                // é¢œè‰²è¾“å…¥å˜åŒ–
                sentColor1.addEventListener('input', () => sentColorPreview1.style.backgroundColor = sentColor1.value);
                sentColor2.addEventListener('input', () => sentColorPreview2.style.backgroundColor = sentColor2.value);
                
                // é€‰é¡¹å¡åˆ‡æ¢
                tabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        const tabId = this.getAttribute('data-tab');
                        
                        // æ›´æ–°æ´»åŠ¨é€‰é¡¹å¡
                        tabs.forEach(t => t.classList.remove('active'));
                        this.classList.add('active');
                        
                        // æ˜¾ç¤ºå¯¹åº”çš„å†…å®¹
                        tabContents.forEach(content => {
                            content.classList.remove('active');
                            if (content.id === `${tabId}Tab`) {
                                content.classList.add('active');
                            }
                        });
                    });
                });
            }
            
            // ä¿å­˜æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
            function saveData() {
                localStorage.setItem('chatUserData', JSON.stringify(userData));
                localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
                localStorage.setItem('autoReplies', JSON.stringify(autoReplies));
                localStorage.setItem('partnerWordStats', JSON.stringify(partnerWordStats));
            }
            
            // åº”ç”¨å£çº¸
            function applyWallpaper(wallpaperId) {
                const wallpaper = wallpapers.find(w => w.id === wallpaperId) || wallpapers[0];
                document.body.style.background = wallpaper.gradient;
                userData.wallpaper = wallpaperId;
                saveData();
            }
            
            // åº”ç”¨æ°”æ³¡é¢œè‰²
            function applyBubbleColors(color1, color2) {
                document.documentElement.style.setProperty('--sent-bubble-color-1', color1);
                document.documentElement.style.setProperty('--sent-bubble-color-2', color2);
                userData.sentBubbleColor1 = color1;
                userData.sentBubbleColor2 = color2;
                saveData();
            }
            
            // æ›´æ–°é¢œè‰²è¾“å…¥æ¡†
            function updateColorInputs() {
                sentColor1.value = userData.sentBubbleColor1;
                sentColor2.value = userData.sentBubbleColor2;
                sentColorPreview1.style.backgroundColor = userData.sentBubbleColor1;
                sentColorPreview2.style.backgroundColor = userData.sentBubbleColor2;
            }
            
            // æ¸²æŸ“å£çº¸é€‰é¡¹
            function renderWallpaperOptions() {
                wallpaperGrid.innerHTML = '';
                wallpapers.forEach(wallpaper => {
                    const option = document.createElement('div');
                    option.className = `wallpaper-option ${wallpaper.id === userData.wallpaper ? 'active' : ''}`;
                    option.style.background = wallpaper.gradient;
                    option.dataset.id = wallpaper.id;
                    option.addEventListener('click', function() {
                        applyWallpaper(this.dataset.id);
                        document.querySelectorAll('.wallpaper-option').forEach(opt => opt.classList.remove('active'));
                        this.classList.add('active');
                    });
                    wallpaperGrid.appendChild(option);
                });
            }
            
            // æ¸²æŸ“é£æ ¼é¢„è®¾
            function renderStylePresets() {
                stylePresets.innerHTML = '';
                stylePresetsData.forEach(preset => {
                    const presetElement = document.createElement('div');
                    presetElement.className = `style-preset ${preset.color1 === userData.sentBubbleColor1 && preset.color2 === userData.sentBubbleColor2 ? 'active' : ''}`;
                    presetElement.style.background = `linear-gradient(135deg, ${preset.color1} 0%, ${preset.color2} 100%)`;
                    presetElement.textContent = preset.name;
                    presetElement.dataset.color1 = preset.color1;
                    presetElement.dataset.color2 = preset.color2;
                    presetElement.addEventListener('click', function() {
                        applyBubbleColors(this.dataset.color1, this.dataset.color2);
                        updateColorInputs();
                        document.querySelectorAll('.style-preset').forEach(opt => opt.classList.remove('active'));
                        this.classList.add('active');
                    });
                    stylePresets.appendChild(presetElement);
                });
            }
            
            // æ›´æ–°å¯¹æ–¹æ¶ˆæ¯ç»Ÿè®¡
            function updateWordStats() {
                partnerWordStats = {};
                chatHistory.forEach(msg => {
                    if (msg.type === 'received') {
                        const text = msg.text.trim();
                        if (text) {
                            partnerWordStats[text] = (partnerWordStats[text] || 0) + 1;
                        }
                    }
                });
                saveData();
            }
            
            // æ¸²æŸ“å¯¹æ–¹å¸¸ç”¨è¯­ç»Ÿè®¡
            function renderWordStats() {
                wordStatsList.innerHTML = '';
                const sortedStats = Object.entries(partnerWordStats)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 20);
                
                if (sortedStats.length === 0) {
                    wordStatsList.innerHTML = '<div class="word-stat-item">æš‚æ— ç»Ÿè®¡æ•°æ®</div>';
                    return;
                }
                
                sortedStats.forEach(([text, count], index) => {
                    const statItem = document.createElement('div');
                    statItem.className = 'word-stat-item';
                    const rank = index + 1;
                    let rankColor = '#ff6b9d';
                    if (rank === 1) rankColor = '#ff4757';
                    if (rank === 2) rankColor = '#ff6b9d';
                    if (rank === 3) rankColor = '#ffa502';
                    
                    statItem.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="background: ${rankColor}; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px;">${rank}</span>
                            <span>${text}</span>
                        </div>
                        <span class="word-count">${count}æ¬¡</span>
                    `;
                    wordStatsList.appendChild(statItem);
                });
            }
            
            // å¯åŠ¨è‡ªåŠ¨å‘é€æ¶ˆæ¯
            function startAutoSend() {
                if (autoSendTimer) clearTimeout(autoSendTimer);
                if (userData.autoSendEnabled) {
                    const randomTime = Math.floor(Math.random() * (180000 - 30000)) + 30000;
                    autoSendTimer = setTimeout(() => {
                        sendRandomMessage();
                        startAutoSend();
                    }, randomTime);
                }
            }
            
            // å‘é€éšæœºæ¶ˆæ¯
            function sendRandomMessage() {
                if (autoReplies.length === 0) return;
                const randomReply = autoReplies[Math.floor(Math.random() * autoReplies.length)];
                addMessageToHistory(randomReply, 'received');
            }
            
            // å‘é€æ¶ˆæ¯
            function sendMessage() {
                const messageText = messageInput.value.trim();
                if (messageText === '') return;
                
                addMessageToHistory(messageText, 'sent');
                messageInput.value = '';
                messageInput.style.height = 'auto';
                
                // æ¨¡æ‹Ÿå›å¤
                const replyCount = Math.floor(Math.random() * 3) + 1;
                let delay = 1000;
                
                for (let i = 0; i < replyCount; i++) {
                    setTimeout(() => {
                        const randomReply = autoReplies[Math.floor(Math.random() * autoReplies.length)];
                        addMessageToHistory(randomReply, 'received');
                    }, delay);
                    delay += 1000 + Math.random() * 2000;
                }
            }
            
            // æ·»åŠ æ¶ˆæ¯åˆ°å†å²è®°å½•
            function addMessageToHistory(text, type) {
                const now = new Date();
                const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
                const dateString = getCurrentDate();
                
                const message = {
                    text: text,
                    type: type,
                    time: timeString,
                    date: dateString
                };
                
                chatHistory.push(message);
                if (type === 'received') {
                    updateWordStats();
                }
                saveData();
                renderChatHistory();
            }
            
            // æ¸²æŸ“èŠå¤©è®°å½•
            function renderChatHistory() {
                chatMessages.innerHTML = '';
                let lastDate = '';
                
                chatHistory.forEach(msg => {
                    const messageDate = msg.date || getCurrentDate();
                    if (messageDate !== lastDate) {
                        const dateDivider = document.createElement('div');
                        dateDivider.className = 'date-divider';
                        dateDivider.innerHTML = `<span>${formatDate(messageDate)}</span>`;
                        chatMessages.appendChild(dateDivider);
                        lastDate = messageDate;
                    }
                    
                    const messageElement = document.createElement('div');
                    messageElement.className = `message ${msg.type}`;
                    messageElement.innerHTML = `
                        <div class="message-content">${msg.text}</div>
                        <div class="message-time">${msg.time}</div>
                    `;
                    chatMessages.appendChild(messageElement);
                });
                
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // æ¸²æŸ“å›å¤åˆ—è¡¨
            function renderReplyList() {
                replyList.innerHTML = '';
                autoReplies.forEach((reply, index) => {
                    const replyItem = document.createElement('div');
                    replyItem.className = 'reply-item';
                    replyItem.innerHTML = `
                        <span>${reply}</span>
                        <button class="delete-reply" data-index="${index}">Ã—</button>
                    `;
                    replyList.appendChild(replyItem);
                });
                
                document.querySelectorAll('.delete-reply').forEach(button => {
                    button.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        autoReplies.splice(index, 1);
                        saveData();
                        renderReplyList();
                    });
                });
            }
            
            // æ·»åŠ åˆå§‹æ¶ˆæ¯
            function addInitialMessages() {
                const initialMessages = [
                    { text: "æ¬¢è¿æ¥åˆ°ç§äººèŠå¤©å®¤ï¼", type: "received", time: "10:00", date: getCurrentDate() },
                    { text: "è¿™é‡Œåªæœ‰æˆ‘ä»¬ä¸¤ä¸ªäººï¼Œå¯ä»¥ç•…æ‰€æ¬²è¨€~", type: "received", time: "10:01", date: getCurrentDate() },
                    { text: "å¤ªå¥½äº†ï¼æˆ‘å–œæ¬¢è¿™ç§ç§å¯†çš„æ„Ÿè§‰", type: "sent", time: "10:02", date: getCurrentDate() },
                    { text: "è´´è´´ğŸ¥°", type: "received", time: "10:03", date: getCurrentDate() }
                ];
                
                initialMessages.forEach(msg => {
                    chatHistory.push(msg);
                });
                
                updateWordStats();
                saveData();
            }
            
            // è·å–å½“å‰æ—¥æœŸ
            function getCurrentDate() {
                const now = new Date();
                return `${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')}`;
            }
            
            // æ ¼å¼åŒ–æ—¥æœŸæ˜¾ç¤º
            function formatDate(dateString) {
                const date = new Date(dateString);
                const today = new Date();
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);
                
                if (date.toDateString() === today.toDateString()) {
                    return 'ä»Šå¤©';
                } else if (date.toDateString() === yesterday.toDateString()) {
                    return 'æ˜¨å¤©';
                } else {
                    return `${date.getMonth()+1}æœˆ${date.getDate()}æ—¥`;
                }
            }
            
            // äº‹ä»¶å¤„ç†å‡½æ•°
            function saveUserSettingsHandler() {
                userData.nickname = userNickname.value || 'ç”¨æˆ·';
                userData.partnerNickname = partnerNickname.value || 'å¯¹æ–¹';
                saveData();
                userSettingsModal.style.display = 'none';
                alert('è®¾ç½®å·²ä¿å­˜ï¼');
            }
            
            function applyAppearanceHandler() {
                applyBubbleColors(sentColor1.value, sentColor2.value);
                updateColorInputs();
                renderStylePresets();
                appearanceModal.style.display = 'none';
                alert('å¤–è§‚è®¾ç½®å·²æ›´æ–°ï¼');
            }
            
            function addReplyHandler() {
                const replyText = newReply.value.trim();
                if (replyText === '') {
                    alert('è¯·è¾“å…¥å›å¤å†…å®¹ï¼');
                    return;
                }
                autoReplies.push(replyText);
                saveData();
                renderReplyList();
                newReply.value = '';
                alert('å›å¤å·²æ·»åŠ ï¼');
            }
            
            function clearWordStatsHandler() {
                if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ç»Ÿè®¡å—ï¼Ÿ')) {
                    partnerWordStats = {};
                    updateWordStats();
                    renderWordStats();
                    alert('ç»Ÿè®¡å·²æ¸…ç©ºï¼');
                }
            }
            
            // å¯åŠ¨åº”ç”¨
            init();
        });
    </script>
</body>
</html>